<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>Каталог з Google Sheets: категорії як шапки</title>
  <style>
    body { font-family: sans-serif; background: #f8f8f8; }
    .container { max-width: 980px; margin: auto; background: #fff; padding: 24px; border-radius:10px; }
    .category-block { margin:36px 0 18px; padding-bottom: 6px; border-bottom:2px solid #009688;}
    .category-name { font-size:1.5em; font-weight:600; color:#009688;}
    table { border-collapse: collapse; width:100%; margin-bottom: 14px;}
    th, td { border: 1px solid #ccc; padding: 8px 7px; }
    th { background: #eee;}
    img { width:66px; height:66px; object-fit:cover; border-radius:6px; background:#ececec; }
    input[type="number"] { width: 48px; }
    .cart { margin-top: 38px; background: #def; border-radius:6px; padding:17px; }
  </style>
</head>
<body>
  <div class="container">
    <h2>Каталог з Google Sheets (категорії-блоки)</h2>
    <div id="productList"></div>
    <div class="cart">
      <h3>Кошик</h3>
      <div id="cartList">Порожній</div>
      <div id="cartTotal"></div>
    </div>
  </div>
<script>
const SCRIPT_API_URL = "https://script.google.com/macros/s/AKfycbzboN7p7DQpxTg0hhpGlgwnmbXXj3E0CGKa2jtXjm1FRvWujXzxjQK1JTV_oiedI98Kyg/exec"; // заміни на свій!

let dataRows = [];
let cart = {};

function groupByCategory(rows) {
  let categories = {};
  rows.forEach(prod => {
    if (!prod.Category) return;
    if (!categories[prod.Category]) categories[prod.Category] = [];
    categories[prod.Category].push(prod);
  });
  return categories;
}

function renderProducts(rows) {
  const cats = groupByCategory(rows);
  let html = '';
  Object.keys(cats).forEach(catName => {
    const items = cats[catName];
    if (!items.length) return;
    html += `<div class="category-block"><span class="category-name">${catName}</span></div>`;
    html += `<table><tr><th>Фото</th><th>Назва</th><th>Ціна</th><th>Додати</th></tr>`;
    html += items.map((prod, i) => `
      <tr>
        <td>${prod.Image?`<img src="${prod.Image}" />`:''}</td>
        <td>${prod.Full_Name}</td>
        <td>${prod.Price}</td>
        <td>
          <input type="number" id="qty_${catName}_${i}" min="1" max="${prod.Stock||100}" value="1"/>
          <button onclick="addToCart('${catName}',${i})">+</button>
        </td>
      </tr>
    `).join('');
    html += `</table>`;
  });
  document.getElementById('productList').innerHTML = html || 'Немає даних';
}

function addToCart(catName, idx) {
  const cats = groupByCategory(dataRows);
  const prod = cats[catName][idx];
  const input = document.getElementById('qty_' + catName + '_' + idx);
  const qty = parseInt(input.value);
  if (!qty || qty < 1) return alert('Невірна кількість');
  const key = `${catName}_${prod.Full_Name}`;
  if (!cart[key]) cart[key] = {...prod, quantity: 0};
  cart[key].quantity += qty;
  renderCart();
}
function renderCart() {
  const items = Object.values(cart);
  if (!items.length) {
    document.getElementById('cartList').innerHTML = "Порожній";
    document.getElementById('cartTotal').innerHTML = ""
    return;
  }
  let total = 0;
  let html = `<table><tr><th>Товар</th><th>Кількість</th><th>Ціна</th></tr>`;
  html += items.map(itm => {
    let sum = parseFloat(itm.Price)*itm.quantity;
    total += sum;
    return `<tr><td>${itm.Full_Name}</td><td>${itm.quantity}</td><td>${sum.toFixed(2)}</td></tr>`;
  }).join('');
  html += `</table>`;
  document.getElementById('cartList').innerHTML = html;
  document.getElementById('cartTotal').innerHTML = `<b>Всього: ${total.toFixed(2)}</b>`;
}

// Основний запит до Apps Script API
fetch(SCRIPT_API_URL)
  .then(res => res.json())
  .then(json => {
      dataRows = json;
      renderProducts(dataRows);
      cart = {};
      renderCart();
  });

window.addToCart = addToCart;

</script>
</body>
</html>
